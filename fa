@Component
class NotificationSyncScheduler(
    private val adminNotificationsDao: AdminNotificationsDao
) {

    private val log = logger()

    /**
     * –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç –∫–ª–∏–µ–Ω—Ç–æ–≤ —Å –∞–∫—Ç—É–∞–ª—å–Ω—ã–º –∫–µ—à–µ–º –∫–∞–∂–¥—ã–µ 60 —Å–µ–∫—É–Ω–¥.
     * –°–æ–≤–ø–∞–¥–∞–µ—Ç —Å –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–µ—à–∞ (about1Min).
     */
    @Scheduled(fixedDelay = 60000, initialDelay = 60000)  // üü¢ 60 —Å–µ–∫ –≤–º–µ—Å—Ç–æ 30
    fun syncClientsFromCache() {
        try {
            val clientsCount = BroadcastRegistry.getConnectedClientsCount()
            
            if (clientsCount == 0) {
                return
            }
            
            log.debug("üîÑ Syncing {} connected clients from cache", clientsCount)
            
            val allNotifications = adminNotificationsDao.feedAll()
                .map { it.toFeedResponse() }
            
            if (allNotifications.isEmpty()) {
                log.debug("üì≠ No active notifications in cache")
                BroadcastRegistry.syncFromCache(emptyList())
                return
            }
            
            log.info("üì¢ Syncing {} notifications to {} clients from cache", 
                allNotifications.size, clientsCount)
            
            BroadcastRegistry.syncFromCache(allNotifications)
            
        } catch (e: Exception) {
            log.error("‚ùå Error syncing clients from cache: {}", e.message, e)
        }
    }
}
