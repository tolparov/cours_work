package ru.sber.poirot.audit.websocket

import ru.sber.poirot.audit.model.AuditEvent
import com.fasterxml.jackson.annotation.JsonInclude
import com.fasterxml.jackson.annotation.JsonProperty

@JsonInclude(JsonInclude.Include.NON_NULL)
data class WsMessage(
    val type: Type,
    val data: List<AuditEvent>? = null,
    val message: String? = null
) {
    enum class Type {
        @JsonProperty("data") DATA,
        @JsonProperty("ping") PING,
        @JsonProperty("error") ERROR
    }

    companion object {
        fun data(events: List<AuditEvent>) = WsMessage(Type.DATA, data = events)
        fun ping() = WsMessage(Type.PING)
        fun error(msg: String) = WsMessage(Type.ERROR, message = msg)
    }
}
